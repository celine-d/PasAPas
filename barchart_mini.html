<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    
    path { 
    fill: none;
}

   div.tooltip {
        color: #222;
        background-color: #fff;
        padding: .5em;
        text-shadow: #f5f5f5 0 1px 0;
        border-radius: 2px;
        opacity: 0.9;
        position: absolute;
      }  
    
    .hidden {
        display: none;
      }
  </style>
</head>

<body>
    <form>
  Année :
      <label><input type="radio" name="annee" value="all" checked> Tout</label>
      <label><input type="radio" name="annee" value="seize"> 2016</label>
      <label><input type="radio" name="annee" value="dix_sept"> 2017</label>
      <label><input type="radio" name="annee" value="dix_huit" > 2018</label>
      <label><input type="radio" name="annee" value="dix_neuf"> 2019</label>  
  </form>
  
      <form>
  Distance référence :
      <label><input type="radio" name="distance_ref" value="saint_etienne" checked> Lyon-Saint-Étienne : 63 km</label>
      <label><input type="radio" name="distance_ref" value="clermont_ferrand"> Lyon-Clermont-Ferrand : 164 km</label>
      <label><input type="radio" name="distance_ref" value="montpellier"> Lyon-Montpellier : 301 km</label>
  </form>
  <script>
    
  var margin = {top: 20, right: 10, bottom: 20, left: 20};
    
    var tooltip = d3.select("body").append("div") 
      .attr("class", "tooltip")       
      .style("opacity", 0);
  
    // Traduction du jour de la semaine en français
    dictSemaine = {'Sunday':'Dimanche','Monday':'Lundi','Tuesday':'Mardi','Wednesday':'Mercredi','Thursday':'Jeudi','Friday':'Vendredi','Saturday':'Samedi'};
    
    // Traduction du mois en français
    dictMois = {'January':'Janvier','February':'Février','March':'Mars','April':'Avril','May':'Mai','June':'Juin','July':'Juillet','August':'Août','September':'Septembre','October':'Octobre','November':'Novembre','December':'Décembre'};

 
    var Arrondi = d3.format(".0f"); 
    var Arrondi1 = d3.format(".1f"); 
    
    var formatAnnee = d3.timeFormat("%Y");
    var formatMois = d3.timeFormat("%B");
    
    var width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
    
    var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    // parse the date / time
    var parseDate = d3.timeParse("%m_%Y"); //pour convertir dans le format date

    //2. Générer les données
    d3.csv('https://raw.githubusercontent.com/celine-d/PasAPas/master/Health%20Data_moisdistancetri.csv',function(error,data){
      data.forEach(function(d){
        d.mois = parseDate(d.Mois)
        d.distance=+d.Distance;
      });

    var x = d3.scaleLinear()
          .range([0, width-70])
          .domain([0,5]);
      
    var y_mois=d3.scaleTime()
    .domain(d3.extent(data,function(data){return data.mois;}))
    .range([400,0])//sur espace graphique
    
    var data2016 = data.filter(function(d){return formatAnnee(d.mois) == '2016';}),
        data2017 = data.filter(function(d){return formatAnnee(d.mois) == '2017';}),
        data2018 = data.filter(function(d){return formatAnnee(d.mois) == '2018';}),
        data2019 = data.filter(function(d){return formatAnnee(d.mois) == '2019';});
      
    var xAxis=d3.axisBottom()
    .scale(x);
    
    var MoisAxis= d3.axisLeft()
    .scale(y_mois)
    .tickFormat(function(d){
     return dictMois[formatMois(d)]+' '+formatAnnee(d);});
      
     svg.selectAll(".bar")
      .data(data)
      .enter().append("rect")
      .attr("class", "bar")
      .style("fill", "grey")
      .attr('transform','translate(70,' + -10 + ')')
      .attr("width", function(d) {return x(d.distance)/63; } )
      .attr("y", function(d) { return y_mois(d.mois); })
      .attr("height", 10)
      .on('mousemove', function(d) {
          var mouse = d3.mouse(svg.node()).map(function(d) {
            return parseInt(d);
          })
          tooltip.classed('hidden', false)
                  .attr('style', 'left:' + (mouse[0] + 30) + 'px; top:' + (mouse[1]) + 'px')
                  .html(dictMois[formatMois(d.mois)]+' '+formatAnnee(d.mois)+"<br>"+ Arrondi(d.distance) + " km"+"<br>"+Arrondi1(d.distance/63)+" Lyon-Saint-Étienne")
     })
                  .on('mouseout', function() {
          tooltip.classed('hidden', true);
          });
       
     svg.append('g')
    .attr('transform', 'translate(70,' + 400 + ')') 
    .attr('class', 'x axis')
    .call(xAxis)
    
     svg.append("text")             
     .attr("x", width/2 )
     .attr("y", height-margin.top-10 )
     .text("Proportion")
     
     svg.append('g') //groupe dans lequel on met tout pour créer un axe
    .attr('transform','translate(70,' + 0 + ')')
    .attr('class', 'y axis')
    .call(MoisAxis)
   
     
     svg.append("text")
     .attr("transform", "rotate(-90)")
     .attr("y", 0 - margin.left)
     .attr("x",0 - (height / 2))
     .attr("dy", "1em")
     .text("Date")
     
function draw_all() {


}

function draw_seize() {
 // filter(function(d,i){return i<5;})
}
                  
function draw_sept() {
//filter(function(d,i){return 4<i<17;})
  
}
      
function draw_huit() {
  
}

function draw_neuf() {
 
}
      
function size_stetienne() {
    x.domain([0,5])
    xAxis.scale(x)
    d3.selectAll('g.x.axis')
    .transition()
    .attr('transform', 'translate(70,' + 400 + ')')
    .call(xAxis)
    
    svg.selectAll(".bar")
      .attr("class", "bar")
      .style("fill", "grey")
      .attr('transform','translate(70,' + -10 + ')')
      .attr("width", function(d) {return x(d.distance)/63; } )
      .attr("y", function(d) { return y_mois(d.mois); })
      .attr("height", 10)
      .on('mousemove', function(d) {
          var mouse = d3.mouse(svg.node()).map(function(d) {
            return parseInt(d);
          })
          tooltip.classed('hidden', false)
                  .attr('style', 'left:' + (mouse[0] + 30) + 'px; top:' + (mouse[1]) + 'px')
                  .html(dictMois[formatMois(d.mois)]+' '+formatAnnee(d.mois)+"<br>"+ Arrondi(d.distance) + " km"+"<br>"+Arrondi1(d.distance/63)+" Lyon-Saint-Étienne")
     })
                  .on('mouseout', function() {
          tooltip.classed('hidden', true);
          });


}
      
function size_clermontferrand() {
    x.domain([0,2])
    xAxis.scale(x)
    d3.selectAll('g.x.axis')
    .transition()
    .attr('transform', 'translate(70,' + 400 + ')')
    .call(xAxis)
    
    svg.selectAll(".bar")
      .attr("class", "bar")
      .style("fill", "orange")
      .attr('transform','translate(70,' + -10 + ')')
      .attr("width", function(d) {return x(d.distance)/164; } )
      .attr("y", function(d) { return y_mois(d.mois); })
      .attr("height", 10)
      .on('mousemove', function(d) {
          var mouse = d3.mouse(svg.node()).map(function(d) {
            return parseInt(d);
          })
          tooltip.classed('hidden', false)
                  .attr('style', 'left:' + (mouse[0] + 30) + 'px; top:' + (mouse[1]) + 'px')
                  .html(dictMois[formatMois(d.mois)]+' '+formatAnnee(d.mois)+"<br>"+ Arrondi(d.distance) + " km"+"<br>"+Arrondi1(d.distance/164)+" Lyon-Clermont-Ferrand")
     })
                  .on('mouseout', function() {
          tooltip.classed('hidden', true);
          });
}
      
function size_montpellier() {
    x.domain([0,1.5])
    xAxis.scale(x)
    d3.selectAll('g.x.axis')
    .transition()
    .attr('transform', 'translate(70,' + 400 + ')')
    .call(xAxis)
    
    svg.selectAll(".bar")
      .attr("class", "bar")
      .style("fill", "blue")
      .attr('transform','translate(70,' + -10 + ')')
      .attr("width", function(d) {return x(d.distance)/301; } )
      .attr("y", function(d) { return y_mois(d.mois); })
      .attr("height", 10)
      .on('mousemove', function(d) {
          var mouse = d3.mouse(svg.node()).map(function(d) {
            return parseInt(d);
          })
          tooltip.classed('hidden', false)
                  .attr('style', 'left:' + (mouse[0] + 30) + 'px; top:' + (mouse[1]) + 'px')
                  .html(dictMois[formatMois(d.mois)]+' '+formatAnnee(d.mois)+"<br>"+ Arrondi(d.distance) + " km"+"<br>"+Arrondi1(d.distance/301)+" Lyon-Montpellier")
     })
                  .on('mouseout', function() {
          tooltip.classed('hidden', true);
          });
}
      

// définition des relations label/fonction
d3.select("input[value=\"all\"]").on("click", draw_all);
d3.select("input[value=\"seize\"]").on("click", draw_seize);
d3.select("input[value=\"dix_sept\"]").on("click", draw_sept);
d3.select("input[value=\"dix_huit\"]").on("click", draw_huit);
d3.select("input[value=\"dix_neuf\"]").on("click", draw_neuf);
d3.select("input[value=\"saint_etienne\"]").on("click", size_stetienne);
d3.select("input[value=\"clermont_ferrand\"]").on("click", size_clermontferrand);
d3.select("input[value=\"montpellier\"]").on("click", size_montpellier);

   
    }); 
  </script>
</body>
